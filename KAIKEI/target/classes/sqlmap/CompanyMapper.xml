<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ts.kaikei.dao.CompanyDAO">

	<select id="checkCode" parameterType="String" resultType="int" >
    
        SELECT
        	count(*)
        FROM
        	company
        WHERE 1=1
        	AND company_cd = #{company_cd}
        
    </select>
    
    <select id="getCompany" parameterType="CompanyVO" resultType="CompanyVO" >
    
        SELECT *
        FROM company
        WHERE 1=1
        AND company_cd = #{company_cd}
        
    </select>


	<insert id="insertCompany" parameterType="CompanyRegistVO" >
    
    	CREATE
    		SEQUENCE seq_company_${company_cd};
    
        INSERT INTO
        	company(
        		company_cd, 
        		auth_cd, 
        		title, 
        		reg_cd, 
        		fax, 
        		phone, 
        		domain, 
        		ent_id, 
        		ent_date, 
        		ent_prog, 
        		mod_id, 
        		mod_date, 
        		mod_prog
        	)
        VALUES (
        	#{company_cd}, 
        	#{auth_cd}, 
        	#{company_title}, 
        	#{company_regist_cd}, 
        	#{company_fax}, 
        	#{company_phone}, 
        	#{company_domain}, 
        	#{ent_id}, 
        	NOW(), 
        	'Web-kaikei', 
        	#{mod_id}, 
        	NOW(), 
        	'Web-kaikei'
        	)
        
	</insert>
	
	<select id="selectCompany" parameterType="hashmap" resultType="CompanyListVO">
		SELECT * FROM(
		SELECT (ROW_NUMBER() OVER()) AS RN, A.company_cd, A.title, A.phone, A.auth_cd, B.name, A.domain
		FROM company A, users B
		WHERE 1=1
		AND A.company_cd = B.company_cd
		AND B.posit_cd = 'POS002'
		AND A.title LIKE '%' || #{mINPUT} || '%'
		 <if test = "STAT_op != '00'">
		 	<choose>
				<when test = "STAT_op == '01'">
					AND A.auth_cd = 'AUT001'
				</when>
				<when  test = "STAT_op == '02'">
					AND A.auth_cd = 'AUT002'
				</when>
				<when test = "STAT_op == '03'">
					AND A.auth_cd = 'AUT003'
				</when>
			</choose>
		</if>
		
		ORDER BY RN ASC
		) SUBTABLE 
		WHERE 1=1
		AND RN BETWEEN (CAST(#{mPAGE} AS INTEGER) - 1) * 10 + 1 AND CAST(#{mPAGE} AS INTEGER) * 10
		
	</select>
	
	<update id="updateCompany" parameterType="CompanyVO">
	
		UPDATE company
  		SET company_cd = #{company_cd}, auth_cd = #{auth_cd}, title = #{title}, reg_cd = #{reg_cd},
  			fax = #{fax}, phone = #{phone}, domain = #{domain}, bank_title = #{bank_title}, bank_acc = #{bank_acc}, 
  			ent_date = #{ent_date}, ent_prog = #{ent_prog}, mod_id = #{mod_id}, mod_date = #{mod_date}, mod_prog = #{mod_prog}
  		WHERE company_cd = #{company_cd}
  		
	</update>
	
    
</mapper>