<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ts.kaikei.dao.CustomerDAO">
    
    <insert id="addCustomer" parameterType="CustomerVO">
    
        INSERT INTO customer(company_cd, cus_cd, title, reg_cd, 
        					domain, fax, ceo_name, ceo_phone, 
        					ceo_email, worker_name, worker_phone, worker_email, 
        					memo, ent_id, entdate, ent_prog,
        					mod_id, mod_date, mod_prog)
        VALUES(#{company_cd}, #{cus_cd}, #{title}, #{reg_cd}, 
        		#{domain}, #{fax}, #{ceo_name}, #{ceo_phone},
        		#{ceo_email}, #{worker_name}, #{worker_phone}, #{worker_email},
        		#{memo}, #{ent_id}, NOW(), 'Web-kaikei',
        		#{mod_id}, NOW(), 'Web-kaikei')
        
    </insert>
    
    <select id="getCustomerList" parameterType="map" resultType="CustomerVO" >
    
        SELECT cus_cd, title, ceo_name, worker_name, fax
        FROM customer
        WHERE 1=1
        AND company_cd = #{company_cd}
        
        AND (cus_cd LIKE '%' || #{searchParam} || '%'
        OR UPPER(title) LIKE UPPER('%' || #{searchParam} || '%')
        OR UPPER(ceo_name) LIKE UPPER('%' || #{searchParam} || '%'))
        
        ORDER BY cus_cd ASC
		LIMIT 20 OFFSET ${pageNum} * 20
        
    </select>
    
        <select id="getCustomerCount" parameterType="map" resultType="int" >
    
        SELECT (count(*)+19)/20
        FROM customer
        WHERE 1=1
        AND company_cd = #{company_cd}
        
        AND (cus_cd LIKE '%' || #{searchParam} || '%'
        OR UPPER(title) LIKE UPPER('%' || #{searchParam} || '%')
        OR UPPER(ceo_name) LIKE UPPER('%' || #{searchParam} || '%'))
        
    </select>
    
    <select id="getCustomerDetail" parameterType="map" resultType="CustomerVO" >
    
        SELECT cus_cd, title, reg_cd, domain, fax, ceo_name, ceo_phone, ceo_email, worker_name, worker_phone, worker_email, memo
        FROM customer
        WHERE 1=1
        AND company_cd = #{company_cd}
        AND cus_cd = #{cus_cd}
        
    </select>
    
    <update id="updateCustomer" parameterType="CustomerVO">
    
    	UPDATE customer
    	SET title = #{title}, reg_cd = #{reg_cd}, domain = #{domain}, fax = #{fax},
    		ceo_name = #{ceo_name}, ceo_phone = #{ceo_phone}, ceo_email = #{ceo_email}, worker_name = #{worker_name},
    		worker_phone = #{worker_phone}, worker_email = #{worker_email}, memo = #{memo},
    		mod_id = #{mod_id}, mod_date = NOW(), mod_prog = #{mod_prog}
    	WHERE 1=1
        AND company_cd = #{company_cd}
        AND cus_cd = #{cus_cd}
    
    </update>
    
    <delete id="deleteCustomer" parameterType="map" >
    
        DELETE FROM customer 
        WHERE 1=1
        AND company_cd = #{company_cd}
        AND cus_cd = #{cus_cd}
        
    </delete>
    
        <select id="customerCodeCheck" parameterType="map" resultType="int" >
    
        SELECT count(*)
        FROM customer
        WHERE 1=1
        AND company_cd = #{company_cd}
        AND cus_cd = #{cus_cd}
        
    </select>
    
    <select id="getCustomerOf" resultType="CustomerVO" parameterType="String">
	    SELECT *
	    from customer
	    where cus_cd = #{value}
    </select>
    
    <!-- CUSTOMER DELETE FOR COMPANY DELETE MANAGE -->
    <delete id="customerDeletecmp" parameterType="String">
	    DELETE FROM customer
	    WHERE company_cd = #{company_cd}
    </delete>

</mapper>